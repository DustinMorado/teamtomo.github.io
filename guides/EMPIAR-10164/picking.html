
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Particle picking and initial model generation &#8212; Open Subtomo</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Particle pose optimisation in RELION" href="relion.html" />
    <link rel="prev" title="Preprocessing" href="preprocessing.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  
  <h1 class="site-logo" id="site-title">Open Subtomo</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  General Principles
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../general-principles/general-principles.html">
   Summary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../general-principles/overviews/overviews.html">
   Overviews
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../general-principles/subtomogram-averaging/index.html">
   Subtomogram averaging
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../general-principles/subtomogram-averaging/preprocessing/index.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../general-principles/subtomogram-averaging/particle-picking/index.html">
     Particle picking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../general-principles/subtomogram-averaging/refinement/index.html">
     Refinement
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../general-principles/image-processing/introduction.html">
   Image processing
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Guides
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="introduction.html">
   EMPIAR-10164 (HIV VLPs)
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="preprocessing.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Particle picking and initial model generation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="relion.html">
     Particle pose optimisation in RELION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="m.html">
     Multi-particle refinement in M
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Mini-tutorials
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../mini-tutorials/software-usage/index.html">
   Cryo-ET software
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/dynamo/index.html">
     Dynamo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/emclarity/index.html">
     emClarity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/eman/index.html">
     EMAN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/relion/index.html">
     RELION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/m/index.html">
     M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/nova/index.html">
     Nova
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/stopgap/index.html">
     STOPGAP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/software-usage/warp/index.html">
     Warp
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../mini-tutorials/programming/index.html">
   Programming
  </a>
  <ul class="simple collapse-ul">
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../contributing/contributing.html">
   Guide to contributing
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/guides/EMPIAR-10164/picking.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/open-subtomo/open-subtomo"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/open-subtomo/open-subtomo/issues/new?title=Issue%20on%20page%20%2Fguides/EMPIAR-10164/picking.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/open-subtomo/open-subtomo/edit/master/./guides/EMPIAR-10164/picking.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-do-we-know-and-how-can-we-use-it">
   What do we know and how can we use it?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generating-a-dynamo-catalogue-for-particle-picking">
   Generating a Dynamo catalogue for particle picking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vlp-annotation">
   VLP annotation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-our-approach">
     Defining our approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-dipole-set-models">
     Creating dipole set models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-dipoleset-models-into-oversampled-vesicle-models">
     Convert dipoleSet models into oversampled Vesicle models
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-alignments-in-dynamo">
   First alignments in Dynamo
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-a-subset-of-particles">
     Extracting a subset of particles
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-alignment-project">
     The alignment project
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#assessing-the-results">
       Assessing the results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aligning-and-centering-the-6-fold-symmetry-axis-in-the-initial-model">
       Aligning and centering the 6-fold symmetry axis in the initial model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-particles-for-every-vlp">
   Finding particles for every VLP
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#particle-extraction">
     Particle extraction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#particle-alignment">
     Particle alignment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cleaning-the-dataset-based-on-geometrical-constraints">
   Cleaning the dataset based on geometrical constraints
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#next-step">
   Next step
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="particle-picking-and-initial-model-generation">
<h1>Particle picking and initial model generation<a class="headerlink" href="#particle-picking-and-initial-model-generation" title="Permalink to this headline">¶</a></h1>
<p>The tomograms are reconstructed and ready for further analysis. Warp includes a template matching procedure, but what if we don’t know what our object of interest looks like yet? In this section we will:</p>
<ul class="simple">
<li><p>generate an initial model of the HIV-1 CA-SP1 hexamer <em>ab initio</em></p></li>
<li><p>use that model to find particles in all of our tomograms</p></li>
</ul>
<p>In biological systems, particles often have a spatial relationship with an underlying supporting geometry such as a membrane, filament or vescicle.</p>
<p>Exploiting this prior knowledge about the geometry of a system is often useful in subtomogram averaging, reducing both the computational burden and  the ability of particles to end up in obviously wrong positions after an iterative refinement procedure.</p>
<p>In the following sections, we will design and implement an approach to obtain a reconstruction of these lattices, employing prior knowledge about the geometry of the system to drive the subtomogram averaging procedure and enforce a correct final solution. We aim to demonstrate some key principles for producing produce accurate reconstructions from your data <em>ab initio</em>.</p>
<div class="section" id="what-do-we-know-and-how-can-we-use-it">
<h2>What do we know and how can we use it?<a class="headerlink" href="#what-do-we-know-and-how-can-we-use-it" title="Permalink to this headline">¶</a></h2>
<p>Question worth asking yourself repeatedly when designing an approach to a subtomogram averaging problem are <em>“what do we know?”</em>  and <em>“how can we make use of this?”</em></p>
<p>At this stage, looking at the deconvolved tomograms in any visualisation package (3dmod, dynamo_tomoslice, FIJI, napari) allows us to see that:</p>
<ul class="simple">
<li><p>the VLPs are nearly spherical</p></li>
<li><p>proteins on the surface of the VLPs form a hexagonal lattice parallel to the membrane</p></li>
<li><p>the lattice spacing is roughly 7.5 nm</p></li>
</ul>
<p>Can we use this information to help us in our efforts to reconstruct this lattice structure? Absolutely!</p>
<ul class="simple">
<li><p>We can generate initial estimates for particle positions as points on a sphere centered on a VLP with the correct radius. These positions will be incorrect but particles extracted at these positions will contain our lattice structure.</p></li>
<li><p>The lattice is always parallel to the membrane, imparting an orientation normal to the surface of the sphere  onto each particle will provide a consistent estimate for the initial orientation of the particles in the lattice.</p></li>
<li><p>We know that we have a lattice spacing of roughly 7.5 nm, to be sure that we will not miss any particles in the lattice we should oversample the sphere relative to this spacing - we can always remove any duplicates later.</p></li>
</ul>
<p>Dynamo contains many geometrical modelling tools which can help with these geometrical approaches to subtomogram averaging projects. We will make use of a limited subset of these tools in this tutorial, for an overview of the available geometrical models please see <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Model#Types_of_models">here</a>. Becoming familiar with the available tools and thinking about how you can use the geometry of your system to your advantage will help with many subtomogram averaging projects. Below, we used <code class="docutils literal notranslate"><span class="pre">dynamo_tomoslice</span></code> to  estimate the lattice spacing in our tomograms, this tool will be introduced shortly.</p>
<p><img alt="particle distance" src="guides/EMPIAR-10164/README.assets/particle-distance.png" /></p>
</div>
<div class="section" id="generating-a-dynamo-catalogue-for-particle-picking">
<h2>Generating a Dynamo catalogue for particle picking<a class="headerlink" href="#generating-a-dynamo-catalogue-for-particle-picking" title="Permalink to this headline">¶</a></h2>
<p>We now need to decide on a system for managing our reconstructed tomograms and annotations. A Dynamo catalogue is a database which facilitates the management of tomography data, including annotations and subsequent particle extraction.</p>
<p>We have provided a function <code class="docutils literal notranslate"><span class="pre">warp2catalogue</span></code> in the <code class="docutils literal notranslate"><span class="pre">autoalign_dynamo</span></code> package which will setup a catalogue from your Warp tomograms and their deconvolved counterparts. The catalogue is set up in such a way that any visualisation of the tomograms from the catalogue will display the deconvolved volumes but particles are extracted from the unfiltered volumes which are suitable for alignment and averaging experiments.</p>
<p>The function takes two arguments: the warp reconstruction directory and the pixel spacing in the reconstructions.</p>
<p>Let’s create a new <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> folder in the root directory, and navigate to it in Matlab. Then, we run:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">warp2catalogue</span><span class="p">(</span><span class="s">&#39;../frames/reconstruction&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>This will generate the catalogue with the name <code class="docutils literal notranslate"><span class="pre">warp_catalogue</span></code> inside the <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> directory. To open the catalogue manager in dynamo, run</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">dcm</span> <span class="s">warp_catalogue</span>
</pre></div>
</div>
<p>From the catalogue manager which opens up, tomograms can be opened in an interactive browser called <code class="docutils literal notranslate"><span class="pre">dynamo_tomoslice</span></code> by first selecting the tomogram of interest then using the <code class="docutils literal notranslate"><span class="pre">Selected</span> <span class="pre">volume</span> <span class="pre">-&gt;</span> <span class="pre">Open</span> <span class="pre">full</span> <span class="pre">volume</span> <span class="pre">with</span> <span class="pre">tomoslice</span></code> menu options.</p>
<p>At this point we recommend getting comfortable with basic manipulation of the tomoslice viewer. As you can probably tell by the number of buttons and menus, this viewer contains many powerful tools. Don’t be scared! Read the <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Dtmslice">wiki page</a> describing how to use it. Once you feel comfortable, move onto the next section where we will annotate our VLPs to provide initial positions and orientations for subtomogram averaging.</p>
</div>
<div class="section" id="vlp-annotation">
<h2>VLP annotation<a class="headerlink" href="#vlp-annotation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-our-approach">
<h3>Defining our approach<a class="headerlink" href="#defining-our-approach" title="Permalink to this headline">¶</a></h3>
<p>We need to annotate many spherical VLPs within each tomogram. Whilst we could achieve this by annotating each sphere as a vesicle model directly, the workflow for defining vesicle models from <code class="docutils literal notranslate"><span class="pre">dynamo_tomoslice</span></code> requires defining many points for each vesicle model. This approach is robust, but not especially quick if we have many annotations to make.</p>
<p>Instead, we will take a shortcut - spheres can be completely defined by only two values, their centre point and their radius. We will create a <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model in each tomogram to annotate the centres and edge points of many VLPs quickly in just one model, then convert these <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> models into oversampled vesicles with a function which we provide.</p>
</div>
<div class="section" id="creating-dipole-set-models">
<h3>Creating dipole set models<a class="headerlink" href="#creating-dipole-set-models" title="Permalink to this headline">¶</a></h3>
<p>Open up the catalogue <code class="docutils literal notranslate"><span class="pre">warp_catalogue</span></code> we just created using the <code class="docutils literal notranslate"><span class="pre">dcm</span></code> command. Select the first tomogram, then in the menu choose <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">volume</span> <span class="pre">-&gt;</span> <span class="pre">full</span> <span class="pre">tomogram</span> <span class="pre">file</span> <span class="pre">in</span> <span class="pre">tomoslice</span></code>.</p>
<p>We need to create our <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model. To create the model, use the <code class="docutils literal notranslate"><span class="pre">Model</span> <span class="pre">pool</span> <span class="pre">-&gt;</span> <span class="pre">Create</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">model</span> <span class="pre">in</span> <span class="pre">pool</span> <span class="pre">(choose</span> <span class="pre">type)</span> <span class="pre">-&gt;</span> <span class="pre">Dipole</span> <span class="pre">set</span></code> menu options. The active model is now set to the new <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model and we are ready to annotate our VLPs.</p>
<p>Some of the shortcuts we need to know are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code> to set a center point for the current dipole</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> to set a north point for the current dipole</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Enter</span></code> to save the current dipole and move to the next one</p></li>
</ul>
<blockquote>
<div><p>For a full guide on how to interact with <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> models, check out the relevant <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Dipole_set_models">wiki page</a>.</p>
</div></blockquote>
<p>Move the slice in the tomogram and roughly pick the center point of each VLP by moving the cursor to that point and pressing <code class="docutils literal notranslate"><span class="pre">c</span></code>. Then, a point on the surface of the same vescicle and press <code class="docutils literal notranslate"><span class="pre">n</span></code> to define an edge point. A surface rendering of the defined sphere will appear; move the slice and look at the VLP from different orientations to make sure that the sphere matches the VLP well.</p>
<p>While this is trivial for intact vescicles, you will find that several vescicles are damaged or incomplete. As long as they retain a mostly spherical shape, and roughly more than half the capsid is present, we should pick them. We will attempt to remove any non-particles from the data based on geometrical constraints at a later step.</p>
<p><img alt="dipole picking" src="https://i.ibb.co/N1K4GW1/dipole-picking.png" /></p>
<p>With this guide, we provide a short video of this <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model picking on <code class="docutils literal notranslate"><span class="pre">TS_03</span></code>, available as <code class="docutils literal notranslate"><span class="pre">dipoles_picking.mp4</span></code>.</p>
<p>Once all the vescicles in a tomogram are picked, save the model by clicking on <code class="docutils literal notranslate"><span class="pre">Active</span> <span class="pre">Model</span> <span class="pre">-&gt;</span> <span class="pre">Save</span> <span class="pre">active</span> <span class="pre">model</span> <span class="pre">into</span> <span class="pre">catalogue</span> <span class="pre">(disk)</span></code> or clicking the floppy disk icon in the menu bar.</p>
<p>Close the tomoslice window and repeat the process for each tomogram.</p>
<blockquote>
<div><p>If Dynamo asks what to do with the model in pool memory and you already saved the model, choose to delete it. Dynamo may show some elements of the previous <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model when opening a new tomogram. This is a visualisation bug, and does not affect the creation of a new model.</p>
</div></blockquote>
</div>
<div class="section" id="convert-dipoleset-models-into-oversampled-vesicle-models">
<h3>Convert dipoleSet models into oversampled Vesicle models<a class="headerlink" href="#convert-dipoleset-models-into-oversampled-vesicle-models" title="Permalink to this headline">¶</a></h3>
<p>Once all the dipole models are picked, we can convert them into oversampled <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models. For this, we will use the <code class="docutils literal notranslate"><span class="pre">dipoles2vescicles.m</span></code> script provided with this tutorial. The script generates a Dynamo <code class="docutils literal notranslate"><span class="pre">Vescicle</span></code> model for every dipole in each <code class="docutils literal notranslate"><span class="pre">dipoleSet</span></code> model in a catalogue.</p>
<blockquote>
<div><p>We urge interested readers to look at the provided scripts rather than running them blindly; this will help when it comes to tackling the problems posed by your own data!</p>
</div></blockquote>
<p>To generate the <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models, from the <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> directory run:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">dipoles2vescicles</span><span class="p">(</span><span class="s">&#39;warp_catalogue&#39;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="first-alignments-in-dynamo">
<h2>First alignments in Dynamo<a class="headerlink" href="#first-alignments-in-dynamo" title="Permalink to this headline">¶</a></h2>
<p>Now that the Dynamo catalogue contains initial estimates for the positions and orientations of our particles, we need to obtain an initial model of our lattice structure which will later allow us to find more accurate estimates of the positions and orientations of our particles for the whole dataset. For this, we will work on a small subset of the VLPs.</p>
<blockquote>
<div><p>Working on a small subset initially allows you to move quickly, testing lots of different approaches and optimising your approach. How small this subset should be will depend on the quality of your data, your initial particle picking and your object of interest.</p>
</div></blockquote>
<p>For these VLPs and with data of such good quality, two vesicles is more than enough for generating a good initial model.</p>
<p>When choosing an initial subset, it can be a good idea to choose VLPs with different defoci. This ensures that nodes of the CTF are at different spatial frequencies within the subset and thus no region of Fourier space should be particularly undersampled. The Jiang lab at Purdue University have a CTF simulation <a class="reference external" href="https://ctf-simulation.herokuapp.com/">web app</a> which is useful for visualising the effect of defocus on the CTF.</p>
<blockquote>
<div><p>Choosing a subset which contains all available views of the particle is also important, ensuring maximum coverage of Fourier space in a resulting reconstruction</p>
</div></blockquote>
<p>From the <code class="docutils literal notranslate"><span class="pre">Overview</span></code> tab in Warp, we quickly see that <code class="docutils literal notranslate"><span class="pre">TS_01</span></code> and <code class="docutils literal notranslate"><span class="pre">TS_03</span></code> have significanlty different defoci, so we choose to use one vescicle from each of these tomograms.</p>
<div class="section" id="extracting-a-subset-of-particles">
<h3>Extracting a subset of particles<a class="headerlink" href="#extracting-a-subset-of-particles" title="Permalink to this headline">¶</a></h3>
<p>To extract particles from the selected tomograms, open the dynamo catalogue manager by running <code class="docutils literal notranslate"><span class="pre">dcm</span></code> from the <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> directory. Then load the <code class="docutils literal notranslate"><span class="pre">warp_catalogue</span></code> and select <code class="docutils literal notranslate"><span class="pre">TS_01</span></code> and <code class="docutils literal notranslate"><span class="pre">TS_03</span></code>. In the menu, choose <code class="docutils literal notranslate"><span class="pre">Crop</span> <span class="pre">particles</span> <span class="pre">-&gt;</span> <span class="pre">Open</span> <span class="pre">Volume</span> <span class="pre">List</span> <span class="pre">Manager</span></code> to open a list of all models.</p>
<p>From the <code class="docutils literal notranslate"><span class="pre">selection</span></code> tab at the bottom of the window, we <code class="docutils literal notranslate"><span class="pre">pick</span></code> one <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> model from each volume. Then, choose a file name in the <code class="docutils literal notranslate"><span class="pre">Picked</span> <span class="pre">Volume</span> <span class="pre">list</span></code> (we use <code class="docutils literal notranslate"><span class="pre">inimodel.vll</span></code>) and make sure that the sidelength is set to 32.</p>
<blockquote>
<div><p>A box sidelength of 32 corresponds to a 320<span class="math notranslate nohighlight">\(\AA\)</span>. While this is much larger than the expected 75<span class="math notranslate nohighlight">\(\AA\)</span> inter-particle distance, signal from neighbouring particles in lattices can help to drive correct alignments at the beginning of a project. When working at smaller pixel sizes a bigger box can also help to <span class="xref myst">prevent CTF aliasing</span></p>
</div></blockquote>
<p>To extract subvolumes, click the <code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">list</span></code> button to prepare a <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Volume_list_file">volume list file</a> with the necessary information for particle extraction. Following this, clicking <code class="docutils literal notranslate"><span class="pre">Crop</span> <span class="pre">Particles</span></code> will open another GUI from which we can crop particles.</p>
<p>In the newly opened window, we select <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">folder</span> <span class="pre">in</span> <span class="pre">dBoxes</span></code>, choose a name for the data folder then press the <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">cropping</span></code> button. This will take several minutes.</p>
<blockquote>
<div><p>Choosing to save the data as a dBoxes folder speeds things up when setting up subtomogram averaging projects in Dynamo, some checks run fairly slowly if there are too many files in one folder</p>
</div></blockquote>
</div>
<div class="section" id="the-alignment-project">
<h3>The alignment project<a class="headerlink" href="#the-alignment-project" title="Permalink to this headline">¶</a></h3>
<p>Once the particle volumes are extracted for our two VLPs, we want to perform a first rough alignment to see how the particles align and average.</p>
<p>We run <code class="docutils literal notranslate"><span class="pre">dcp</span></code> from MATLAB to open the “Dynamo current project” GUI. This GUI is designed to be used in a sequential way: we will need to provide a few parameters before launching the project.</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Project</span></code>: choose a name for the project
Write <code class="docutils literal notranslate"><span class="pre">inimodel</span></code>, then press <code class="docutils literal notranslate"><span class="pre">Enter</span></code> and <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">project</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">particles</span></code>: select the data folder containing the previously extracted volumes
Click <code class="docutils literal notranslate"><span class="pre">browse</span></code> and select the <code class="docutils literal notranslate"><span class="pre">inimodelData.Boxes</span></code> directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">table</span></code>: choose a Dynamo table file containing particle metadata such as positions and orientations
When we cropped particles in the Dynamo catalogue, it created this metadata file for us and puts it inside the data folder. Click<code class="docutils literal notranslate"><span class="pre">look</span> <span class="pre">inside</span> <span class="pre">data</span> <span class="pre">folder</span></code> and pick the <code class="docutils literal notranslate"><span class="pre">crop.tbl</span></code> file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">template</span></code>: choose an initial template for alignment
We currently don’t have a template. In the <code class="docutils literal notranslate"><span class="pre">I</span> <span class="pre">want</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">a</span> <span class="pre">template</span></code> section, select <code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">a</span> <span class="pre">randomly</span> <span class="pre">chosen</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">particles</span></code>, set the number to <code class="docutils literal notranslate"><span class="pre">500</span></code> and click <code class="docutils literal notranslate"><span class="pre">average</span> <span class="pre">data</span></code> to compute an initial template.</p></li>
</ol>
<blockquote>
<div><p>This will generate a reconstruction from 500 particles using our initial particle orientation estimates from the <code class="docutils literal notranslate"><span class="pre">crop.tbl</span></code> file, originally from the <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models. While we don’t expect to see any detailed structure in this map, it is worth checking that it matches what we expect to see. If you right click on the file path at the top of the template GUI, you can choose to <code class="docutils literal notranslate"><span class="pre">[view]</span></code> the volume. Our initial picking contained no knowledge about the specific positions of each particle within the lattice. Because of this, we expect to see a curved, membrane like density and blurred density for the lattice proteins in the average.</p>
</div></blockquote>
<p><img alt="first template" src="https://i.ibb.co/dM5Dqt5/first-template-all.png" /></p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">masks</span></code>: select masks for each step of the procedure.
Dynamo offers lots of flexibility in the choice and use of masks during the alignment procedure. In this case <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">default</span> <span class="pre">masks</span></code> will calculate appropriate masks at this stage covering the full extent of our 32px box.</p></li>
</ol>
<blockquote>
<div><p>At this stage, we aren’t very sure of our particle positions and orientations as they haven’t undergone any alignment. We want our mask to include the whole box so that signal from multiple neighbouring particles in the lattice can help to drive initial alignments.</p>
</div></blockquote>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">numerical</span> <span class="pre">parameters</span></code>: set the numerical parameters for the alignment procedure.
This section allows us to define many important numerical parameters for an alignment project. Dynamo alignment projects can be split into several rounds which will be executed one after the other. Within each round parameters include number of iterations, angular search ranges, shift limits, high- and low-pass filter limits, symmetry operators to apply to the reference and more.</p></li>
</ol>
<blockquote>
<div><p>At this stage, we don’t enforce symmetry during refinement. We expect that any symmetry present should appear in an initial average. The assumption of symmetry is a useful tool but it reduces our ability to discern any asymmetries that may be present in the reconstruction. It should be applied only when you are sure that your object is symmetric and the possibility of unresolved asymmetry should be kept in mind.</p>
</div></blockquote>
<blockquote>
<div><p>Press <code class="docutils literal notranslate"><span class="pre">Alt</span></code> when a parameter is selected for a detailed description.</p>
</div></blockquote>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">computing</span> <span class="pre">environment</span></code>: the computing environment on which the alignment project will run</p>
<p>This will depend on your computing environment, including number of available CPUs/GPUs.</p>
</li>
</ol>
<blockquote>
<div><p>We typically run projects in the <code class="docutils literal notranslate"><span class="pre">gpu_standalone</span></code> modus on 4 GPUs. Running in the standalone modus allows you to continue with other work in the matlab shell while the alignment project runs. In this modus, the number of CPU cores should be 1. The number of CPU cores used during averaging can be changed to the number of logical CPU cores on your machine. Specific GPUs can be selected by their index as seen in <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>.</p>
</div></blockquote>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">check</span></code> runs a sanity check to make sure the project seems correctly setup, <code class="docutils literal notranslate"><span class="pre">unfold</span></code> prepares an executable for the alignment project.</p></li>
</ol>
<blockquote>
<div><p>If running a project on a remote machine without graphical access, a project can be set up locally and sent to the remote machine as a tarball. For information on this, please see the following <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Tarring_projects">wiki page</a></p>
</div></blockquote>
<ol class="simple">
<li><p>We can now run the executable.To do so, open the <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> directory in a terminal and run:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="nv">$DYNAMO_ROOT</span>/dynamo_activate_linux_shipped_MCR.sh
</pre></div>
</div>
<p>to prepare the environment. Then, simply execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./inimodel.exe
</pre></div>
</div>
<blockquote>
<div><p>You can track the progress of the project from the <code class="docutils literal notranslate"><span class="pre">dcp</span></code> GUI by clicking on <code class="docutils literal notranslate"><span class="pre">progress</span></code>.</p>
</div></blockquote>
<div class="section" id="assessing-the-results">
<h4>Assessing the results<a class="headerlink" href="#assessing-the-results" title="Permalink to this headline">¶</a></h4>
<p>We can look at the result of our first alignment project using tools from the <code class="docutils literal notranslate"><span class="pre">dcp</span></code> GUI under show. Alternatively, the file containing the average can be found at <code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/results/ite_0004/averages/average_ref_001_ite_0004.em</span></code> and visualised with any volume visualisation tool.</p>
<p>In contrast to our previous reconstruction from particles with initial estimates for positions and orientations, in this map we clearly see a hexagonal lattice starting to take shape, containing 2-, 3- and 6-fold symmetry axes.</p>
<p><img alt="first aligned map" src="https://i.ibb.co/wgby9P2/first-align-all.png" /></p>
<p>In order to take advantage of the highest symmetry order present in the structure during refinement we first need to recenter the average on its 6-fold symmetry axis and align that axis along the z axis of our volume.</p>
<blockquote>
<div><p>By convention, rotational symmetry axes in electron microscopy software are aligned along the Z axis of the volume</p>
</div></blockquote>
</div>
<div class="section" id="aligning-and-centering-the-6-fold-symmetry-axis-in-the-initial-model">
<h4>Aligning and centering the 6-fold symmetry axis in the initial model<a class="headerlink" href="#aligning-and-centering-the-6-fold-symmetry-axis-in-the-initial-model" title="Permalink to this headline">¶</a></h4>
<p>To center and align the 6-fold symmetry axis, we will use a script provided with this tutorial, <code class="docutils literal notranslate"><span class="pre">align_symmetry_axis.m</span></code>. The script generates a synthetic template of the lattice with the 6-fold symmetry axis centered and aligned along the z-axis. The result of the alignment project is then aligned to this synthetic template and C6 symmetry is applied to produce our final initial model with the symmetry axis correctly aligned.</p>
<p>To run the script, open <code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/results/ite_0004/averages</span></code> in Matlab. Copy the script into this directory, and execute it by running <code class="docutils literal notranslate"><span class="pre">align_symmetry_axis</span></code>. Once the script has finished, compare the initial average, the template, the aligned average and the symmetrised aligned average to check that the alignment worked as intended.</p>
<p><img alt="aligned to z " src="https://i.ibb.co/Jxd9nXc/aligned-to-z.png" /></p>
<p>Now that we have an initial model with the 6-fold symmetry, we can use this in an alignment project with particles from all of the VLPs to obtain good estimates for particle positions and orientations for the whole dataset.</p>
</div>
</div>
</div>
<div class="section" id="finding-particles-for-every-vlp">
<h2>Finding particles for every VLP<a class="headerlink" href="#finding-particles-for-every-vlp" title="Permalink to this headline">¶</a></h2>
<p><em>“What do we know and how can we use it?”</em></p>
<p>We now have</p>
<ul class="simple">
<li><p>initial estimates for the particle positions and orientations on the surface of every VLP</p></li>
<li><p>a good initial model centered on the 6-fold symmetry axis of the lattice structure.</p></li>
</ul>
<p>We can use this information to run a one iteration subtomogram averaging project. This should allow us to obtain a good set of particle positions and orientations for the dataset which we can later use for higher resolution reconstruction.</p>
<div class="section" id="particle-extraction">
<h3>Particle extraction<a class="headerlink" href="#particle-extraction" title="Permalink to this headline">¶</a></h3>
<p>As for the initial model generation step, we need to extract our particles prior to alignment, this time from all VLPs rather than just a subset. Extract particles from <code class="docutils literal notranslate"><span class="pre">dcm</span></code>  as before, selecting all <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models.</p>
</div>
<div class="section" id="particle-alignment">
<h3>Particle alignment<a class="headerlink" href="#particle-alignment" title="Permalink to this headline">¶</a></h3>
<p>Next we set up an alignment project using <code class="docutils literal notranslate"><span class="pre">dcp</span></code> where the aim is to align each oversampled initial particle position to the closest real particle position in the lattice. The important parameters when setting up this project are:</p>
<ol class="simple">
<li><p>Data should be the extracted data folder for the whole dataset</p></li>
<li><p>Table should be the cropping table derived when extracting the data, found in the data folder</p></li>
<li><p>Template should now be the aligned, symmetrised initial model
<code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/ite_0004/averages/average_aligned_along_z_c6.em</span></code>.</p></li>
<li><p>We only want to run for one iteration</p></li>
</ol>
<blockquote>
<div><p>Now that we’re working with the full dataset, calculations take significantly longer. Because our initial model is good one iteration of alignment should allow us to see the lattice structure appear in the particle positions.</p>
</div></blockquote>
<ol class="simple">
<li><p>We only want to perform local in plane and out of plane angular searches</p></li>
</ol>
<blockquote>
<div><p>We are already fairly sure about our out of plane angles because they come from our <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models. The in plane searches can be limited because of the C6 symmetry of the reference</p>
</div></blockquote>
<ol class="simple">
<li><p>We should adjust the shifts so that particles can only move half of the lattice spacing in the x and y direction</p></li>
</ol>
<blockquote>
<div><p>We expect to find a lattice of particles with roughly 7.5 nm spacing. If we allow each particle to shift a maximum of 4nm in each direction it should be guaranteed to find the closest true position in the lattice but cannot move too far. This maximises the chances of finding all lattice positions from the beginning.</p>
</div></blockquote>
<ol class="simple">
<li><p>We should allow the particles to shift more in z than in x and y to account for any errors when defining our <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models.</p></li>
</ol>
<p>Once the parameters are all set, run the project from the command line as before. This will take significantly longer!</p>
</div>
</div>
<div class="section" id="cleaning-the-dataset-based-on-geometrical-constraints">
<h2>Cleaning the dataset based on geometrical constraints<a class="headerlink" href="#cleaning-the-dataset-based-on-geometrical-constraints" title="Permalink to this headline">¶</a></h2>
<p>To isolate a good subset of particles in lattices we will use three short scripts provided with this tutorial.</p>
<blockquote>
<div><p>The provided scripts are just a few lines long, and are given for convenience and illustration purposes. You are encouraged to read them and modify them for your own purposes</p>
</div></blockquote>
<p>The first cleaning step we should take is removing duplicate particles. To do so, we will use <code class="docutils literal notranslate"><span class="pre">remove_duplicates.m</span></code>.
Open MATLAB in <code class="docutils literal notranslate"><span class="pre">dynamo/findparticles/results/ite_0001/averages</span></code>, then run:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">remove_duplicates</span>
</pre></div>
</div>
<p>This will create a new table called <code class="docutils literal notranslate"><span class="pre">result_10Apx_nodup.tbl</span></code>, reducing clusters of multiple particles within 4 pixels (half the distance we measured earlier) to a single particle.</p>
<p>The next step is to remove particles that don’t belong to the lattice. To do so, first run:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">check_radial_distribution</span>
</pre></div>
</div>
<p>This will open a plot of the radial distribution of neighbouring particles for the whole dataset. Here, we can see a high peak at around 7.5 <span class="math notranslate nohighlight">\(px\)</span>, and periodic peaks after that.</p>
<p><img alt="radial distribution" src="https://i.ibb.co/gJ0K1Q0/radial-distance.png" /></p>
<p>This confirms the previously measured interparticle distance and the fact that most particles slid into ordered positions in the lattice. We can use the first peak to select against particles that don’t conform to this distribution. The next script, <code class="docutils literal notranslate"><span class="pre">subset_table_based_on_neighbours.m</span></code>, removes all particles that don’t have at least 3 neighbours in the radial shell at distance 7.5 <span class="math notranslate nohighlight">\(px\)</span>. To use it, run:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">subset_table_based_on_neighbours</span>
</pre></div>
</div>
<blockquote>
<div><p>When finished, the script will open a viewer to inspect the table before and after the processing. Switching to a less clean dataset (for example <code class="docutils literal notranslate"><span class="pre">TS_43</span></code>) will make it clear that most bad particles were removed.</p>
</div></blockquote>
<p>The final output is a new table called <code class="docutils literal notranslate"><span class="pre">result_10Apx_nodup_neighbourcleaning.tbl</span></code> which contains only references to the particles that we selected.</p>
</div>
<div class="section" id="next-step">
<h2>Next step<a class="headerlink" href="#next-step" title="Permalink to this headline">¶</a></h2>
<p>click <a class="reference internal" href="relion.html"><span class="doc std std-doc">here</span></a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./guides/EMPIAR-10164"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="preprocessing.html" title="previous page">Preprocessing</a>
    <a class='right-next' id="next-link" href="relion.html" title="next page">Particle pose optimisation in RELION</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By the open-subtomo contributors<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>